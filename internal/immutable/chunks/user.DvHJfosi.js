import{d as i,w}from"./index.Dmtj9H_x.js";import{l as m}from"./httpAccess.oZ7xIxns.js";import{j as r}from"./scheduler.CgEFyQ-S.js";import{E as g,i as b,s as o,a as p,t as v}from"./index.ibyW_jwT.js";import{g as k}from"./entry.C7xj7j3Z.js";import{b as y}from"./paths.CDMbSYKj.js";const a=w(typeof navigator=="object"?navigator.onLine:!1),E=i(a,e=>e);function h(){return r(E)}function O(){a.set(!0)}function W(){a.set(!1)}window.addEventListener("online",O),window.addEventListener("offline",W);const l=m("token",null),n=m("user",null);i(n,e=>e);const _=i(n,e=>!!e),s=new g;async function x(e,t){const d=await v.token({username:e,password:t});return U(d)}async function U(e){o(e);const t=await p.currentUser();return n.set(t),l.set(e),s.emit("user",t),t}function u(){n.set(null),l.set(null),o(void 0),s.emit("signOut")}let c=!0;async function G(){try{let e=r(n);if(c){if(h()){const t=r(l);t?(o(t),e=await p.currentUser(),n.set(e),s.emit("user",e)):(u(),e=null)}else e&&s.emit("user",e);c=!1}return e}catch(e){return console.error(e),u(),null}}var f;(f=b.middleware)==null||f.push({async post(e){switch(e.response.status){case 503:await k(`${y}/maintenance`)}}});export{_ as a,u as b,x as s,G as t};
