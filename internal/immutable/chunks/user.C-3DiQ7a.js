import{d as a,w as b}from"./index.Dmtj9H_x.js";import{l as w}from"./httpAccess.oZ7xIxns.js";import{j as r}from"./scheduler.CgEFyQ-S.js";import{E as k,i as v,s as o,a as d,t as y}from"./index.ibyW_jwT.js";import{g as c}from"./entry.BBsLv14k.js";import{b as f}from"./paths.CHAn_gxj.js";const l=b(typeof navigator=="object"?navigator.onLine:!1),E=a(l,e=>e);function h(){return r(E)}function O(){l.set(!0)}function W(){l.set(!1)}window.addEventListener("online",O),window.addEventListener("offline",W);const u=w("token",null),n=w("user",null);a(n,e=>e);const _=a(n,e=>!!e),s=new k;async function $(e,t){const g=await y.token({username:e,password:t});return U(g)}async function U(e){o(e);const t=await d.currentUser();return n.set(t),u.set(e),s.emit("user",t),t}function i(){n.set(null),u.set(null),o(void 0),s.emit("signOut")}let m=!0;async function x(){try{let e=r(n);if(m){if(h()){const t=r(u);t?(o(t),e=await d.currentUser(),n.set(e),s.emit("user",e)):(i(),e=null)}else e&&s.emit("user",e);m=!1}return e}catch(e){return console.error(e),i(),null}}var p;(p=v.middleware)==null||p.push({async post(e){switch(e.response.status){case 401:{i(),await c(`${f}/signin`);break}case 503:{await c(`${f}/maintenance`);break}}}});export{_ as a,i as b,$ as s,x as t};
