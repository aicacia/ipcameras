var be=Object.defineProperty;var Ee=(n,e,t)=>e in n?be(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _=(n,e,t)=>Ee(n,typeof e!="symbol"?e+"":e,t);import{g as te,l as Ce,a as Te}from"./httpAccess.oZ7xIxns.js";import{j as J}from"./scheduler.CgEFyQ-S.js";import{d as ne,w as re}from"./index.Dmtj9H_x.js";const K=re(navigator.language),En=ne(K,n=>n);function Se(n){K.set(n)}function _e(){return J(K)}window.addEventListener("languagechange",()=>{Se(navigator.language)});function G(n,e){return n[0]=(e&4278190080)>>24,n[1]=(e&16711680)>>16,n[2]=(e&65280)>>8,n[3]=e&255,n}function Ie(n){return n[3]|n[2]<<8|n[1]<<16|n[0]<<24}const b=Math.pow(2,31)-1|0,V={},A={};class M{constructor(e,t){if(e!==V)throw new TypeError("Options can only be created with the some or none functions");this._value=t}static some(e){return v(e)}static none(){return x()}static from(e){return e!=null?v(e):x()}static fromJSON(e){return M.from(e)}isNone(){return this._value===A}isSome(){return!this.isNone()}expect(e){if(this.isSome())return this._value;throw new Error(typeof e=="function"?e():e)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(e){return this.isSome()?this._value:e}unwrapOrElse(e){return this.isSome()?this._value:e()}map(e){return this.isSome()?v(e(this._value)):x()}mapOr(e,t){return this.isSome()?v(e(this._value)):v(t)}mapOrElse(e,t){return this.isSome()?v(e(this._value)):v(t())}flatMap(e){return this.isSome()?e(this._value):x()}flatMapOr(e,t){return this.isSome()?e(this._value):t}flatMapOrElse(e,t){return this.isSome()?e(this._value):t()}and(e){return this.isSome()?e:x()}andThen(e){return this.isSome()?e(this._value):x()}or(e){return this.isNone()?e:this}orElse(e){return this.isNone()?e():this}xor(e){const t=this.isSome(),r=e.isSome();return t&&!r?this:!t&&r?e:x()}filter(e){return this.isSome()&&e(this._value)?this:x()}getOrInsert(e){return this.isNone()&&(this._value=e),this}getOrInsertWith(e){return this.isNone()&&(this._value=e()),this}clear(){return this._value=A,this}take(){if(this.isSome()){const e=this._value;return this._value=A,v(e)}else return x()}from(e){return e!=null?this._value=e:this.clear(),this}replace(e){return this._value=e,this}ifSome(e,t){return this.isSome()?e(this._value):t&&t(),this}ifNone(e,t){return this.isNone()?e():t&&t(this._value),this}toJSON(){return this.unwrapOr(null)}toJS(){return this.unwrapOr(null)}[Symbol.iterator](){return new Re(this._value)}}class Re{constructor(e){this.value=e}next(){if(this.value===A)return{done:!0,value:void 0};{const e=this.value;return this.value=A,{done:!1,value:e}}}}const v=n=>new M(V,n),x=()=>new M(V,A);class f{constructor(e){this._index=0,this._iter=e}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){const e=this._iter.next();return e.done?e:{value:[e.value,this._index++]}}enumerate(){throw new Error("Enumerate was not imported!")}peekable(){throw new Error("Peekable was not imported!")}forEach(e){throw new Error("ForEach was not imported!")}map(e){throw new Error("Map was not imported!")}merge(e){throw new Error("Merge was not imported!")}concat(e){return this.merge(e)}filter(e){throw new Error("Filter was not imported!")}step(e){throw new Error("Step was not imported!")}skip(e){throw new Error("Skip was not imported!")}take(e){throw new Error("Take was not imported!")}toMap(e,t){throw new Error("ToMap was not imported!")}flatten(e){throw new Error("Flatten was not imported!")}unflatten(e){throw new Error("Unflatten was not imported!")}reverse(){throw new Error("Reverse was not imported!")}count(){return this.reduce(0,e=>e+1)}consume(){let e=this.next();for(;!e.done;)e=this.next();return this}toArray(){return this.reduce([],(e,t)=>(e.push(t),e))}join(e){return this.toArray().join(e)}indexOf(e){let t=this.next(),r=0;for(;!t.done;){if(t.value===e)return r;r++,t=this.next()}return-1}findIndex(e){let t=this.nextWithIndex();for(;!t.done;){const[r,i]=t.value;if(e(r,i))return i;t=this.nextWithIndex()}return-1}find(e){let t=this.nextWithIndex();for(;!t.done;){const[r,i]=t.value;if(e(r,i))return v(r);t=this.nextWithIndex()}return x()}findAll(e){return this.filter(e)}nth(e=0){let t=this.next();for(e<0&&(e=0);!t.done;){if(e--<=0)return v(t.value);t=this.next()}return x()}first(){return this.nth(0)}last(){let e=this.next();for(;!e.done;){const t=this.next();if(t.done)return v(e.value);e=t}return x()}any(e){return this.findIndex(e)!==-1}some(e){return this.any(e)}none(e){return this.findIndex(e)===-1}all(e){let t=this.nextWithIndex();for(;!t.done;){const[r,i]=t.value;if(!e(r,i))return!1;t=this.nextWithIndex()}return!0}reduce(e,t){let r=this.next();for(;!r.done;){const i=r.value;e=t(e,i,this._index-1),r=this.next()}return e}}function U(n){return n!=null?typeof n[Symbol.iterator]=="function"?new f(n[Symbol.iterator]()):typeof n.next=="function"?n instanceof f?n:new f(n):U(typeof n=="object"?Object.entries(n):[n]):U([])}class Ae extends f{constructor(e){super(e)}next(){const e=super.nextWithIndex();return e.done?e:{value:ke(e.value)}}}f.prototype.enumerate=function(){return new Ae(this)};function ke(n){const e=n[0],t=n;return t[0]=n[1],t[1]=e,t}const Le=n=>n,Oe=n=>n;class Pe extends f{constructor(e,t=Le,r=Oe){super(e),this._map=([i,s])=>[t(i,s),r(i,s)]}toObject(){return this.reduce({},(e,t)=>(e[t[0]]=t[1],e))}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._map(e.value)}}}f.prototype.toMap=function(e,t){return new Pe(this,e,t)};class De extends f{constructor(e,t){super(e),this._fn=t}next(){let e=super.nextWithIndex();for(;!e.done;){const[t,r]=e.value;if(this._fn(t,r))return{done:!1,value:t};e=super.nextWithIndex()}return{done:!0,value:void 0}}}f.prototype.filter=function(e){return new De(this,e)};class Ne extends f{constructor(e,t){super(e),this._fn=([r,i])=>(t(r,i),r)}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._fn(e.value)}}}f.prototype.forEach=function(e){return new Ne(this,e)};let Ue=class extends f{constructor(e,t){super(e),this._fn=t}next(){const e=super.nextWithIndex();if(e.done)return e;{const[t,r]=e.value;return{done:!1,value:this._fn(t,r)}}}};f.prototype.map=function(e){return new Ue(this,e)};class Fe extends f{constructor(e,t){super(e),this._other=t}next(){const e=super.next();return e.done?this._other.next():e}}f.prototype.merge=function(e){return new Fe(this,e)};class Me extends f{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?v(this.peeked.shift()):x()}peek(e=0){if(e<this.peeked.length)return v(this.peeked[e]);{let t=this.peeked.length-e-1,r=super.next();for(;!r.done&&(this.peeked.push(r.value),!(--t<=0));)r=super.next();return r.done?x():v(r.value)}}next(){const e=this.unpeek();if(e.isSome())return{done:!1,value:e.unwrap()};const t=super.next();return t.done?t:{done:!1,value:t.value}}}f.prototype.peekable=function(){return new Me(this)};class $e extends f{constructor(e){super(e),this.index=0,this.reversed=!1,this.values=[]}next(){if(!this.reversed){let e=super.next();for(;!e.done;)this.values.push(e),e=super.next();this.reversed=!0,this.index=this.values.length}return this.index===0?{done:!0,value:void 0}:(this.index-=1,this.values[this.index])}}f.prototype.reverse=function(){return new $e(this)};class qe extends f{constructor(e,t){super(e),this._skipped=0,this._skip=(t<=0?0:t)|0}next(){let e=super.next();for(;!e.done;)if(this._skipped<=this._skip)this._skipped+=1,e=super.next();else return e;return{done:!0,value:void 0}}}f.prototype.skip=function(n){return new qe(this,n)};class We extends f{constructor(e,t){super(e),this._stepped=0,this._step=t<=0?1:t|0}next(){let e=super.next();for(;!e.done;)if(this._stepped<this._step)this._stepped+=1,e=super.next();else return this._stepped=0,e;return{done:!0,value:void 0}}}f.prototype.step=function(n){return new We(this,n)};class ze extends f{constructor(e,t){super(e),this._taken=0,this._count=(t<=0?0:t)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}f.prototype.take=function(e){return new ze(this,e)};class Be extends f{constructor(e,t){super(e),this._fn=t}next(){return this._fn(this._iter)}}f.prototype.unflatten=function(e){return new Be(this,e)};class He extends f{constructor(e,t=1){super(e),this._current=void 0,this._depth=t}next(){if(this._current!==void 0){const e=this._current.next();if(e.done)this._current=void 0;else return e}return this._nextRecur()}_nextRecur(){const e=super.next();if(e.done)return e;if(this._depth>0){const t=U(e.value).flatten(this._depth-1),r=t.next();return r.done?this._nextRecur():(this._current=t,r)}else return e}}f.prototype.flatten=function(e=1){return new He(this,e)};class Je extends f{constructor(e){super(e),this.rng=e}iter(){return new f(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class Ke extends f{constructor(e,t=0,r=1){super(e),this.rng=e,this.min=t,this.max=r}iter(){return new f(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class Ge extends f{constructor(e,t=0,r=b){super(e),this.rng=e,this.min=t|0,this.max=r|0}iter(){return new f(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const Ve=new Uint8Array(4);class X{nextFloat(){return this.nextInt()/b}nextFloatInRange(e=0,t=1){return e+this.nextFloat()*(t-e)}nextIntInRange(e=0,t=b){return Math.round(this.nextFloatInRange(e,t))}shuffle(e){const t=e.length;for(let r=0;r<t;r++){const i=r+this.nextIntInRange(0,t-r-1),s=e[r];e[r]=e[i],e[i]=s}return e}fromArray(e){return e.length?v(e[this.nextIntInRange(0,e.length-1)]):x()}keyFromObject(e){return this.fromArray(Object.keys(e))}valueFromObject(e){return this.fromArray(Object.values(e))}fillBytes(e){const t=Ve;for(let r=0,i=e.length;r<i;r++){const s=r%4;s===0&&G(t,this.nextInt()),e[r]=t[s]}return e}[Symbol.iterator](){return this}iter(){return new f(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new Je(this)}uniformFloat(e=0,t=1){return new Ke(this,e,t)}uniformInt(e=0,t=b){return new Ge(this,e,t)}}const ie=typeof crypto<"u"&&typeof crypto.getRandomValues=="function",Xe=new Uint32Array(1),je=new Uint8Array(4),se=ie?()=>crypto.getRandomValues(Xe)[0]%b:()=>Math.random()*b|0,Ye=ie?n=>crypto.getRandomValues(Array.isArray(n)?new Uint8Array(n):n):n=>{const e=je;for(let t=0,r=n.length;t<r;t++){const i=t%4;i===0&&G(e,se()),n[t]=e[i]}return n};class Ze extends X{nextInt(){return se()}fillBytes(e){return Ye(e)}}class oe extends X{constructor(e=423257940){super(),this.seed=e}setSeed(e=423257940){return this.seed=e,this}nextInt(){return this.seed=Math.imul(48271,this.seed)|0%b,this.seed&b}}const Qe=new oe;class j extends X{constructor(e,t,r,i){super(),this.x=423257940,this.y=2829571177,this.z=2541948421,this.w=289122235,this.set(e,t,r,i)}static fromSeed(e){return new j().setSeed(e)}setSeed(e){const t=Qe.setSeed(e);return this.set(t.nextInt(),t.nextInt(),t.nextInt(),t.nextInt())}set(e=423257940,t=2829571177,r=2541948421,i=289122235){return this.x=e|0,this.y=t|0,this.z=r|0,this.w=i|0,this}nextInt(){const e=this.x,t=e^e<<11;this.x=this.y,this.y=this.z,this.z=this.w;const r=this.w;return this.w=r^r>>19^(t^t>>8),this.w}}new oe;new j;const et=new Ze;let tt=et;function nt(){return tt.nextFloat()}function Tn(){return nt()*b|0}function rt(n){return JSON.parse(atob(n.split(".")[1]).toString())}function ae(n,e=!0){return`${e?"https":"http"}://${n}`}function it(n,e=!0){return`${e?"wss":"ws"}://${n}`}var Sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function st(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function _n(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var ce={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,u,a){this.fn=c,this.context=u,this.once=a||!1}function s(c,u,a,d,w){if(typeof a!="function")throw new TypeError("The listener must be a function");var g=new i(a,d||c,w),p=t?t+u:u;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],g]:c._events[p].push(g):(c._events[p]=g,c._eventsCount++),c}function h(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],a,d;if(this._eventsCount===0)return u;for(d in a=this._events)e.call(a,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(a)):u},o.prototype.listeners=function(u){var a=t?t+u:u,d=this._events[a];if(!d)return[];if(d.fn)return[d.fn];for(var w=0,g=d.length,p=new Array(g);w<g;w++)p[w]=d[w].fn;return p},o.prototype.listenerCount=function(u){var a=t?t+u:u,d=this._events[a];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,a,d,w,g,p){var E=t?t+u:u;if(!this._events[E])return!1;var l=this._events[E],C=arguments.length,S,m;if(l.fn){switch(l.once&&this.removeListener(u,l.fn,void 0,!0),C){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,a),!0;case 3:return l.fn.call(l.context,a,d),!0;case 4:return l.fn.call(l.context,a,d,w),!0;case 5:return l.fn.call(l.context,a,d,w,g),!0;case 6:return l.fn.call(l.context,a,d,w,g,p),!0}for(m=1,S=new Array(C-1);m<C;m++)S[m-1]=arguments[m];l.fn.apply(l.context,S)}else{var ve=l.length,L;for(m=0;m<ve;m++)switch(l[m].once&&this.removeListener(u,l[m].fn,void 0,!0),C){case 1:l[m].fn.call(l[m].context);break;case 2:l[m].fn.call(l[m].context,a);break;case 3:l[m].fn.call(l[m].context,a,d);break;case 4:l[m].fn.call(l[m].context,a,d,w);break;default:if(!S)for(L=1,S=new Array(C-1);L<C;L++)S[L-1]=arguments[L];l[m].fn.apply(l[m].context,S)}}return!0},o.prototype.on=function(u,a,d){return s(this,u,a,d,!1)},o.prototype.once=function(u,a,d){return s(this,u,a,d,!0)},o.prototype.removeListener=function(u,a,d,w){var g=t?t+u:u;if(!this._events[g])return this;if(!a)return h(this,g),this;var p=this._events[g];if(p.fn)p.fn===a&&(!w||p.once)&&(!d||p.context===d)&&h(this,g);else{for(var E=0,l=[],C=p.length;E<C;E++)(p[E].fn!==a||w&&!p[E].once||d&&p[E].context!==d)&&l.push(p[E]);l.length?this._events[g]=l.length===1?l[0]:l:h(this,g)}return this},o.prototype.removeAllListeners=function(u){var a;return u?(a=t?t+u:u,this._events[a]&&h(this,a)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(ce);var ot=ce.exports;const ue=st(ot),at=16384,he=4096;function de(n,e){const t=new Uint8Array(n.byteLength+e.byteLength);return t.set(n),t.set(e,n.byteLength),t}function ct(n,e,t){if(t.byteLength>=n.byteLength-e){const r=new Uint8Array(n.byteLength*2);return r.set(n),r.set(t,e),r}return n.set(t,e),n}function Y(){return Math.random()*b|0}function ut(n,e,t){return new WritableStream({write(r){ht(n,de(e,r),t)}})}function ht(n,e,t){if(e.byteLength<t)n.send(e);else{let r=0;for(;r<e.byteLength;){const i=Math.min(t,e.byteLength-r);n.send(e.slice(r,r+i)),r+=i}}}function dt(n,e=he){const t=new Uint8Array(e);let r=0;const i=n.getWriter();async function s(o){o.byteLength>t.byteLength-r&&await h(),o.byteLength>=t.byteLength?await i.write(o):(t.set(o,r),r+=o.byteLength)}async function h(){r>0&&(await i.write(t.slice(0,r)),r=0)}return new WritableStream({write:s,async close(){await h(),await i.close()}})}async function lt(n){try{const{done:e,value:t}=await n.read();if(e)return new Uint8Array;let r=t;for(;;){const{done:i,value:s}=await n.read();if(i)break;r=de(r,s)}return r}finally{n.releaseLock()}}const le=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,ft=/^[ \t]+(.*[^ \t])/,wt=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/,pt=10,mt=13,R=new TextEncoder,gt=new TextDecoder;class yt extends Request{constructor(e,t){const r=t==null?void 0:t.headers;if(super(e,t),r){const i=new Headers(r);Object.defineProperty(this,"headers",{value:i,writable:!1})}}}async function xt(n){const e=we(n),[t,r]=await bt(e),[i,s,h]=await Et(e),o=fe(e,s,h);return new Response(o,{status:t,statusText:r,headers:i})}async function vt(n,e){var c,u;const t=n.getWriter(),[r,i]=e instanceof Request?[e,null]:[null,e];r?await t.write(R.encode(`${r.method} ${r.url} HTTP/1.1\r
`)):await t.write(R.encode(`HTTP/1.1 ${i.status} ${i.statusText}\r
`));const s=e.headers;let h=0,o=!1;e.body&&(h=Number.parseInt(s.get("Content-Length")||"0",10),o=((c=s.get("Transfer-Encoding"))==null?void 0:c.toLowerCase())==="chunked");for(const[a,d]of s.entries())await t.write(R.encode(`${a}: ${d}\r
`));if(e.body)if(r){const a=await lt(e.body.getReader());await t.write(R.encode(`Content-Length: ${a.byteLength}\r
\r
`)),await t.write(a),t.releaseLock(),n.close()}else await t.write(R.encode(`\r
`)),t.releaseLock(),await((u=fe(we(e.body.getReader()),o,h))==null?void 0:u.pipeTo(n));else await t.write(R.encode(`\r
`)),t.releaseLock(),n.close()}async function bt(n){const{done:e,value:t}=await n.readLine();if(e)throw new Error("Unexpected end of request");const r=wt.exec(t);if(!r)throw new Error(`Invalid response line: ${t}`);return[+r[3],r[4],+r[1],+r[2]]}async function Et(n){const e=new Headers;let t=!1,r=0;for(;;){const{done:i,value:s}=await n.readLine();if(i)throw new Error("Unexpected end of headers");if(s==="")break;const h=le.exec(s);if(!h)throw new Error(`Invalid header line: ${s}`);let o=h[2];for(;;){const u=ft.exec(o);if(!u)break;o=u[1]}const c=h[1].toLowerCase();c==="transfer-encoding"&&o.toLowerCase()==="chunked"?t=!0:c==="content-length"&&(r=+o),e.append(h[1],o)}return[e,t,r]}function fe(n,e,t){if(!e&&t===0)return null;const r=new TransformStream;return Ct(n,r.writable,e,t),r.readable}async function Ct(n,e,t,r){const i=e.getWriter();try{if(t)for(;;){const{done:s,value:h}=await n.readLine();if(s)throw new Error("Unexpected end of stream");if(le.exec(h)){await n.readLine();break}const o=Number.parseInt(h,16);if(!o)break;let c=o;for(;c>0;){const{done:u,value:a}=await n.read(o);if(u)throw new Error("Unexpected end of stream");c-=a.byteLength,await i.write(a)}await n.readLine()}else{let s=r;for(;s>0;){const{done:h,value:o}=await n.read(s);if(h)throw new Error("Unexpected end of stream");s-=o.byteLength,await i.write(o)}}}finally{n.releaseLock(),i.releaseLock(),e.close()}}function we(n,e=he){let t=new Uint8Array(e),r=0,i=0,s=!1;async function h(a){if(s)return a<i;for(;a>i;){const{done:d,value:w}=await n.read();if(d){s=!0;break}t=ct(t,i,w),i+=w.byteLength}return a<i}async function o(){let a=r,d=!0;for(;d;){if(t[a]===mt&&t[a+1]===pt){const w=gt.decode(t.slice(r,a));return r=a+2,{done:!1,value:w}}a++,a>=i&&(d=await h(a))}return{done:!0}}async function c(a){const d=r+a;await h(d);const w=Math.min(i-r,a);if(w===0)return{done:!0};const g=t.slice(r,r+w);return r+=w,{done:!1,value:g}}function u(){n.releaseLock()}return{readLine:o,read:c,releaseLock:u}}function Tt(n){const e=new Map;function t(){let h=Y();for(;e.has(h);)h=Y();const o=G(new Uint8Array(4),h),c=new TransformStream,u={idBytes:o,stream:c,writer:c.writable.getWriter()};return e.set(h,u),u}async function r(h,o){const c=e.get(h);if(!c)throw new Error(`No connection found for id: ${h}`);await c.writer.write(o)}async function i(h){const o=new Uint8Array(h.data),c=Ie(o);await r(c,o.slice(4))}n.addEventListener("message",i);const s=(h,o)=>new Promise((c,u)=>{const a=new yt(h,o),d=t(),w=dt(ut(n,d.idBytes,at));vt(w,a).then(()=>xt(d.stream.readable.getReader()).then(c)).catch(u)});return s.destroy=()=>n.removeEventListener("message",i),s}var y=[];for(var q=0;q<256;++q)y.push((q+256).toString(16).slice(1));function St(n,e=0){return(y[n[e+0]]+y[n[e+1]]+y[n[e+2]]+y[n[e+3]]+"-"+y[n[e+4]]+y[n[e+5]]+"-"+y[n[e+6]]+y[n[e+7]]+"-"+y[n[e+8]]+y[n[e+9]]+"-"+y[n[e+10]]+y[n[e+11]]+y[n[e+12]]+y[n[e+13]]+y[n[e+14]]+y[n[e+15]]).toLowerCase()}var D,_t=new Uint8Array(16);function It(){if(!D&&(D=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(_t)}var Rt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Z={randomUUID:Rt};function Q(n,e,t){if(Z.randomUUID&&!e&&!n)return Z.randomUUID();n=n||{};var r=n.random||(n.rng||It)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,St(r)}const At=16384,kt={RTCPeerConnection:typeof RTCPeerConnection>"u"?null:RTCPeerConnection,RTCSessionDescription:typeof RTCSessionDescription>"u"?null:RTCSessionDescription,RTCIceCandidate:typeof RTCIceCandidate>"u"?null:RTCIceCandidate};class Lt extends ue{constructor(e){super(),this.initiator=!1,this.maxChannelMessageSize=At,this.sdpTransform=Ot,this.config={iceServers:[]},this.pendingCandidates=[],this.webrtc=kt,this.id=e.id||Q(),this.channelName=e.channelName||Q(),e.channelConfig&&(this.channelConfig=e.channelConfig),e.sdpTransform&&(this.sdpTransform=e.sdpTransform),e.config&&(this.config=e.config),e.offerConfig&&(this.offerConfig=e.offerConfig),e.answerConfig&&(this.answerConfig=e.answerConfig),e.maxChannelMessageSize&&e.maxChannelMessageSize>0&&(this.maxChannelMessageSize=e.maxChannelMessageSize),e.webrtc&&(this.webrtc=e.webrtc)}getId(){return this.id}getConnection(){return this.connection}getChannel(){return this.channel}isReady(){return this.channel&&this.channel.readyState==="open"}isClosed(){return!this.connection||this.connection.connectionState!=="connected"}ready(){return this.isReady()?Promise.resolve():this.waitOnce("connect")}isInitiator(){return this.initiator}init(){return this.initiator=!0,this.createPeer()}close(){return this.internalClose(!0)}send(e){if(!this.channel)throw new Error("Channel not initialized");return this.channel.send(e),this}write(e){if(!this.channel)throw new Error("Channel not initialized");return pe(this.channel,e,this.maxChannelMessageSize)}writableStream(){if(!this.channel)throw new Error("Channel not initialized");return Pt(this.channel,this.maxChannelMessageSize)}readableStream(){if(!this.channel)throw new Error("Channel not initialized");return Dt(this.channel)}async signal(e){var t,r;switch(this.connection||await this.createPeer(),console.debug(`${this.id}: received signal message=${e.type}`),e.type){case"renegotiate":return this.negotiate();case"transceiverRequest":{if(!this.initiator)throw new Error("Invalid signal state");const i=e.transceiverRequest;if(!i)throw new Error("Invalid signal message");return await this.addTransceiverFromKind(i.kind,i.init),this}case"candidate":{if(!this.connection)throw new Error("Connection not initialized");const i=e.candidate;if(!i)throw new Error("Invalid signal message");const s=new this.webrtc.RTCIceCandidate(i);return this.connection.remoteDescription==null?this.pendingCandidates.push(s):await this.connection.addIceCandidate(s),this}case"answer":case"offer":case"pranswer":case"rollback":{if(!this.connection)throw new Error("Connection not initialized");const i=e.sdp;if(!i)throw new Error("Invalid signal message");const s=new this.webrtc.RTCSessionDescription({type:e.type,sdp:i});await this.connection.setRemoteDescription(s);for(const h of this.pendingCandidates)await this.connection.addIceCandidate(h);return this.pendingCandidates.length=0,((r=(t=this.connection)===null||t===void 0?void 0:t.remoteDescription)===null||r===void 0?void 0:r.type)==="offer"&&await this.createAnswer(),this.emit("negotiated"),console.debug(`${this.id}: set remote sdp`),this}default:throw console.debug(`${this.id}: invalid signal type: ${e}`),new Error("Invalid signal message type")}}waitOnce(e){return new Promise(t=>{this.once(e,(...r)=>{switch(r.length){case 0:t(void 0);break;case 1:t(r[0]);break;default:t(r);break}})})}addTransceiverFromKind(e,t){if(!this.connection)throw new Error("Connection not initialized");if(this.initiator){const r=this.connection.addTransceiver(e,t);return this.emit("transceiver",r),r}return this.internalSignal({type:"transceiverRequest",transceiverRequest:{kind:e,init:t}}),null}addTrack(e){if(!this.connection)throw new Error("Connection not initialized");return this.connection.addTrack(e)}removeTrack(e){if(!this.connection)throw new Error("Connection not initialized");return this.connection.removeTrack(e),this}internalSignal(e){return this.emit("signal",e),this}async negotiate(){return this.initiator?await this.createOffer():this.internalSignal({type:"renegotiate",renegotiate:!0}),this}async createOffer(){if(!this.connection)throw new Error("Connection not initialized");const e=await this.connection.createOffer(this.offerConfig);return e.sdp=this.sdpTransform(e.sdp),await this.connection.setLocalDescription(e),this.internalSignal({type:e.type,sdp:e.sdp}),this}async createAnswer(){if(!this.connection)throw new Error("Connection not initialized");const e=await this.connection.createAnswer(this.answerConfig);return e.sdp=this.sdpTransform(e.sdp),await this.connection.setLocalDescription(e),this.internalSignal({type:e.type,sdp:e.sdp}),this}createPeer(){if(this.internalClose(!1),this.connection=new this.webrtc.RTCPeerConnection(this.config),this.connection.addEventListener("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.connection.addEventListener("iceconnectionstatechange",this.onICEConnectionStateChange.bind(this)),this.connection.addEventListener("icegatheringstatechange",this.onICEGatheringStateChange.bind(this)),this.connection.addEventListener("connectionstatechange",this.onConnectionStateChange.bind(this)),this.connection.addEventListener("icecandidate",this.onICECandidate.bind(this)),this.connection.addEventListener("signalingstatechange",this.onSignalingStateChange.bind(this)),this.connection.addEventListener("track",this.onTrackRemote.bind(this)),this.initiator){const e=this.connection.createDataChannel(this.channelName,this.channelConfig);e.addEventListener("open",this.onDataChannelOpen.bind(this)),e.addEventListener("message",this.onDataChannelMessage.bind(this)),e.addEventListener("error",this.onDataChannelError.bind(this)),this.channel=e}else this.connection.addEventListener("datachannel",this.onDataChannel.bind(this));return this}internalClose(e=!0){return this.channel&&(this.channel.close(),this.channel=void 0),this.connection&&(this.connection.close(),this.connection=void 0),e&&this.emit("close"),this}onConnectionStateChange(){if(this.connection)switch(console.debug(`${this.id}: connection state ${this.connection.connectionState}`),this.connection.connectionState){case"failed":case"disconnected":case"closed":this.internalClose(!0);break}}onNegotiationNeeded(){if(this.connection)return this.negotiate()}onICEConnectionStateChange(){this.connection&&console.debug(`${this.id}: ice connection state ${this.connection.iceConnectionState}`)}onICEGatheringStateChange(){this.connection&&console.debug(`${this.id}: ice gathering state ${this.connection.iceGatheringState}`)}onSignalingStateChange(){this.connection&&console.debug(`${this.id}: signaling state ${this.connection.signalingState}`)}onICECandidate(e){e.candidate&&this.internalSignal({type:"candidate",candidate:e.candidate})}onTrackRemote(e){this.emit("track",e)}onDataChannel(e){const t=e.channel;this.channel=t,this.channel.onopen=this.onDataChannelOpen.bind(this),this.channel.onmessage=this.onDataChannelMessage.bind(this),this.channel.onerror=this.onDataChannelError.bind(this)}onDataChannelOpen(){console.debug(`${this.id}: data channel open`),this.emit("connect")}onDataChannelMessage(e){this.emit("data",e.data)}onDataChannelError(e){this.emit("error",new Error("DataChannel error",{cause:e}))}}function Ot(n){return n}function pe(n,e,t){if(typeof e=="string")if(e.length<t)n.send(e);else{let r=0;for(;r<e.length;){const i=Math.min(t,e.length-r);n.send(e.substring(r,r+i)),r+=i}}else if(e instanceof Blob)if(e.size<t)n.send(e);else{let r=0;for(;r<e.size;){const i=Math.min(t,e.size-r);n.send(e.slice(r,r+i)),r+=i}}else{let r;if(e instanceof ArrayBuffer?r=e:r=e.buffer,r.byteLength<t)n.send(r);else{let i=0;for(;i<r.byteLength;){const s=Math.min(t,r.byteLength-i);n.send(r.slice(i,i+s)),i+=s}}}}function Pt(n,e){return new WritableStream({write(t){pe(n,t,e)}})}function Dt(n){let e=!1,t=!1;const r=[],i=[];function s(){return new Promise((c,u)=>i.push([c,u]))}function h(c){if(i.length){const[u,a]=i.shift();u(c.data)}else r.push(c.data)}n.addEventListener("message",h);const o=()=>{if(!e){n.removeEventListener("message",h),n.removeEventListener("close",o),e=!0;for(const[c,u]of i)u(new Error("Stream closed"));i.length=0,r.length=0}};return n.addEventListener("close",o),new ReadableStream({async pull(c){if(e){t||(t=!0,c.close());return}r.length?c.enqueue(r.shift()):c.enqueue(await s())},cancel:o})}class Nt extends ue{constructor(e){super(),this.connected=!1,this.connecting=!1,this.reconnecting=!1,this.closed=!1,this.connectTime=Date.now(),this.minTimeBetweenReconnectsMS=0,this.url=e.url,e.WebSocket?this.WebSocket=e.WebSocket:this.WebSocket=WebSocket,e.minTimeBetweenReconnectsMS&&(this.minTimeBetweenReconnectsMS=e.minTimeBetweenReconnectsMS),e.autoconnect&&this.connect()}send(e){var t;if(!this.connected)throw new Error("WebSocket not ready");return(t=this.websocket)===null||t===void 0||t.send(e),this}ready(){return this.connected?Promise.resolve():this.waitOnce("open")}waitOnce(e){return new Promise(t=>{this.once(e,(...r)=>{switch(r.length){case 0:t(void 0);break;case 1:t(r[0]);break;default:t(r);break}})})}close(e,t){this.connected=!1,this.connecting=!1,this.closed=!0,this.websocket?this.websocket.close(e,t):this.emit("close")}async connect(){if(this.connected)return this;if(this.connecting)return this;this.connecting=!0;try{this.connectTime=Date.now();const e=new this.WebSocket(await this.url()),t=()=>{e.removeEventListener("open",t),this.connected=!0,this.emit("open")};e.addEventListener("open",t),e.addEventListener("close",()=>{this.websocket=void 0,this.connected=!1,this.closed?this.emit("close"):(this.emit("disconnect"),this.reconnect())}),e.addEventListener("message",r=>{this.emit("message",r.data)}),e.addEventListener("error",()=>{this.emit("error")}),this.websocket=e}catch(e){this.emit("error",e),this.reconnect()}finally{this.connecting=!1}return this}reconnect(){if(this.reconnecting)return this;this.reconnecting=!0;try{const e=Date.now()-this.connectTime;e<this.minTimeBetweenReconnectsMS?setTimeout(()=>{this.connect()},this.minTimeBetweenReconnectsMS-e):this.connect()}finally{this.reconnecting=!1}return this}}const H=new Map,O=new Nt({url:Mt});O.on("message",n=>{const e=JSON.parse(n),t=H.get(e.peerId);t&&t.signal(e.message)});let N;function Ut(){if(N)return N;{let n;return N=(e,t)=>{if(!n){const r=Ft("webrtchttp");n=r.ready().then(()=>Tt(r.getChannel())),r.on("close",()=>{n=void 0})}return n.then(r=>r(e,t))},N}}function Ft(n){O.connect();const e=new Lt({config:{iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},channelConfig:{ordered:!0}});return e.on("error",t=>console.error(t)),e.on("signal",t=>{O.send(JSON.stringify({type:"signal",peerId:e.getId(),message:t}))}),O.ready().then(()=>{O.send(JSON.stringify({type:"init",peerId:e.getId(),peerType:n}))}),e.on("close",()=>{H.delete(e.getId())}),H.set(e.getId(),e),e}async function Mt(){const n=te();if(!n)throw new Error("No remote access configured");const e=await $t(n);return`${it(n.host,n.ssl)}/client/websocket?token=${e}`}let W,z;async function $t(n){return(!z||z<=Date.now())&&(W=await qt(n),z=rt(W).exp*1e3),W}async function qt(n){const e={id:n.id,password:n.password},t={"Content-Type":"application/json"},r=await fetch(`${ae(n.host,n.ssl)}/client`,{method:"POST",headers:t,credentials:"same-origin",mode:"cors",body:JSON.stringify(e)});if(r.status>=400)throw new Error("failed to authenticate");return await r.text()}const Wt=Ce("access","http");function ee(){return J(Wt)}const zt="America/New_York",me=re(Jt());ne(me,n=>n);function Bt(){return J(me)}function Ht(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}}function Jt(){return Ht()||zt}const Kt="http://localhost:3000".replace(/\/+$/,"");class ge{constructor(e={}){this.configuration=e}set config(e){this.configuration=e}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:Kt}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||ye}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const e=this.configuration.apiKey;if(e)return typeof e=="function"?e:()=>e}get accessToken(){const e=this.configuration.accessToken;if(e)return typeof e=="function"?e:async()=>e}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}const Gt=new ge,F=class F{constructor(e=Gt){_(this,"middleware");_(this,"fetchApi",async(e,t)=>{let r={url:e,init:t};for(const s of this.middleware)s.pre&&(r=await s.pre({fetch:this.fetchApi,...r})||r);let i;try{i=await(this.configuration.fetchApi||fetch)(r.url,r.init)}catch(s){for(const h of this.middleware)h.onError&&(i=await h.onError({fetch:this.fetchApi,url:r.url,init:r.init,error:s,response:i?i.clone():void 0})||i);if(i===void 0)throw s instanceof Error?new Yt(s,"The request failed and the interceptors did not return an alternative response"):s}for(const s of this.middleware)s.post&&(i=await s.post({fetch:this.fetchApi,url:r.url,init:r.init,response:i.clone()})||i);return i});this.configuration=e,this.middleware=e.middleware}withMiddleware(...e){const t=this.clone();return t.middleware=t.middleware.concat(...e),t}withPreMiddleware(...e){const t=e.map(r=>({pre:r}));return this.withMiddleware(...t)}withPostMiddleware(...e){const t=e.map(r=>({post:r}));return this.withMiddleware(...t)}isJsonMime(e){return e?F.jsonRegex.test(e):!1}async request(e,t){const{url:r,init:i}=await this.createFetchParams(e,t),s=await this.fetchApi(r,i);if(s&&s.status>=200&&s.status<300)return s;throw new jt(s,"Response returned an error code")}async createFetchParams(e,t){let r=this.configuration.basePath+e.path;e.query!==void 0&&Object.keys(e.query).length!==0&&(r+="?"+this.configuration.queryParamsStringify(e.query));const i=Object.assign({},this.configuration.headers,e.headers);Object.keys(i).forEach(a=>i[a]===void 0?delete i[a]:{});const s=typeof t=="function"?t:async()=>t,h={method:e.method,headers:i,body:e.body,credentials:this.configuration.credentials},o={...h,...await s({init:h,context:e})};let c;Xt(o.body)||o.body instanceof URLSearchParams||Vt(o.body)?c=o.body:this.isJsonMime(i["Content-Type"])?c=JSON.stringify(o.body):c=o.body;const u={...o,body:c};return{url:r,init:u}}clone(){const e=this.constructor,t=new e(this.configuration);return t.middleware=this.middleware.slice(),t}};_(F,"jsonRegex",new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i"));let k=F;function Vt(n){return typeof Blob<"u"&&n instanceof Blob}function Xt(n){return typeof FormData<"u"&&n instanceof FormData}class jt extends Error{constructor(t,r){super(r);_(this,"name","ResponseError");this.response=t}}class Yt extends Error{constructor(t,r){super(r);_(this,"name","FetchError");this.cause=t}}class P extends Error{constructor(t,r){super(r);_(this,"name","RequiredError");this.field=t}}function ye(n,e=""){return Object.keys(n).map(t=>xe(t,n[t],e)).filter(t=>t.length>0).join("&")}function xe(n,e,t=""){const r=t+(t.length?`[${n}]`:n);if(e instanceof Array){const i=e.map(s=>encodeURIComponent(String(s))).join(`&${encodeURIComponent(r)}=`);return`${encodeURIComponent(r)}=${i}`}if(e instanceof Set){const i=Array.from(e);return xe(n,i,t)}return e instanceof Date?`${encodeURIComponent(r)}=${encodeURIComponent(e.toISOString())}`:e instanceof Object?ye(e,r):`${encodeURIComponent(r)}=${encodeURIComponent(String(e))}`}class T{constructor(e,t=r=>r){this.raw=e,this.transformer=t}async value(){return this.transformer(await this.raw.json())}}class Zt{constructor(e){this.raw=e}async value(){}}function B(n){return Qt(n)}function Qt(n,e){return n==null?n:{createdAt:n.createdAt==null?void 0:new Date(n.createdAt),discovered:n.discovered,hardwareId:n.hardwareId,mediaUris:n.mediaUris,name:n.name,record:n.record,recordWindow:n.recordWindow==null?void 0:n.recordWindow,saved:n.saved,updatedAt:new Date(n.updatedAt)}}function en(n){return n==null?n:{password:n.password,username:n.username}}function tn(n){return nn(n)}function nn(n,e){return n==null?n:{date:new Date(n.date)}}function rn(n){return sn(n)}function sn(n,e){return n==null?n:{host:n.host,id:n.id,password:n.password,ssl:n.ssl}}function on(n){return n==null?n:{password:n.password,passwordConfirmation:n.passwordConfirmation}}function an(n){return cn(n)}function cn(n,e){return n==null?n:{accessToken:n.accessToken,expiresIn:n.expiresIn,issuedTokenType:n.issuedTokenType,refreshToken:n.refreshToken,refreshTokenExpiresIn:n.refreshTokenExpiresIn,tokenType:n.tokenType}}function un(n){return hn(n)}function hn(n,e){return n==null?n:{createdAt:new Date(n.createdAt),updatedAt:new Date(n.updatedAt),username:n.username}}function dn(n){return ln(n)}function ln(n,e){return n==null?n:{build:n.build,version:n.version}}class fn extends k{async healthCheckRaw(e){const t={},r={},i=await this.request({path:"/health",method:"GET",headers:r,query:t},e);return new T(i,s=>tn(s))}async healthCheck(e){return await(await this.healthCheckRaw(e)).value()}async p2pAccessRaw(e){const t={},r={};this.configuration&&this.configuration.apiKey&&(r.Authorization=await this.configuration.apiKey("Authorization"));const i=await this.request({path:"/p2p-access",method:"GET",headers:r,query:t},e);return new T(i,s=>rn(s))}async p2pAccess(e){return await(await this.p2pAccessRaw(e)).value()}async versionRaw(e){const t={},r={},i=await this.request({path:"/version",method:"GET",headers:r,query:t},e);return new T(i,s=>dn(s))}async version(e){return await(await this.versionRaw(e)).value()}}class wn extends k{async cameraByHardwareIdRaw(e,t){if(e.hardwareId==null)throw new P("hardwareId",'Required parameter "hardwareId" was null or undefined when calling cameraByHardwareId().');const r={},i={};this.configuration&&this.configuration.apiKey&&(i.Authorization=await this.configuration.apiKey("Authorization"));const s=await this.request({path:"/cameras/{hardwareId}".replace("{hardwareId}",encodeURIComponent(String(e.hardwareId))),method:"GET",headers:i,query:r},t);return new T(s,h=>B(h))}async cameraByHardwareId(e,t){return await(await this.cameraByHardwareIdRaw({hardwareId:e},t)).value()}async camerasRaw(e){const t={},r={};this.configuration&&this.configuration.apiKey&&(r.Authorization=await this.configuration.apiKey("Authorization"));const i=await this.request({path:"/cameras",method:"GET",headers:r,query:t},e);return new T(i,s=>s.map(B))}async cameras(e){return await(await this.camerasRaw(e)).value()}async updateCameraByHardwareIdRaw(e,t){if(e.hardwareId==null)throw new P("hardwareId",'Required parameter "hardwareId" was null or undefined when calling updateCameraByHardwareId().');if(e.updates==null)throw new P("updates",'Required parameter "updates" was null or undefined when calling updateCameraByHardwareId().');const r={},i={};i["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(i.Authorization=await this.configuration.apiKey("Authorization"));const s=await this.request({path:"/cameras/{hardwareId}".replace("{hardwareId}",encodeURIComponent(String(e.hardwareId))),method:"PATCH",headers:i,query:r,body:e.updates},t);return new T(s,h=>B(h))}async updateCameraByHardwareId(e,t,r){return await(await this.updateCameraByHardwareIdRaw({hardwareId:e,updates:t},r)).value()}}class pn extends k{async currentUserRaw(e){const t={},r={};this.configuration&&this.configuration.apiKey&&(r.Authorization=await this.configuration.apiKey("Authorization"));const i=await this.request({path:"/user",method:"GET",headers:r,query:t},e);return new T(i,s=>un(s))}async currentUser(e){return await(await this.currentUserRaw(e)).value()}async resetPasswordRaw(e,t){if(e.resetPassword==null)throw new P("resetPassword",'Required parameter "resetPassword" was null or undefined when calling resetPassword().');const r={},i={};i["Content-Type"]="application/json",this.configuration&&this.configuration.apiKey&&(i.Authorization=await this.configuration.apiKey("Authorization"));const s=await this.request({path:"/user/reset-password",method:"PATCH",headers:i,query:r,body:on(e.resetPassword)},t);return new Zt(s)}async resetPassword(e,t){await this.resetPasswordRaw({resetPassword:e},t)}}class mn extends k{async tokenRaw(e,t){if(e.credentials==null)throw new P("credentials",'Required parameter "credentials" was null or undefined when calling token().');const r={},i={};i["Content-Type"]="application/json";const s=await this.request({path:"/token",method:"POST",headers:i,query:r,body:en(e.credentials)},t);return new T(s,h=>an(h))}async token(e,t){return await(await this.tokenRaw({credentials:e},t)).value()}}let I;const gn={middleware:[{pre:async n=>({...n,init:{...n.init,mode:"cors"}})}],apiKey(n){switch(n){case"X-Timezone":return Bt();case"X-Locale":return _e();case"Authorization":return`${I==null?void 0:I.tokenType} ${I==null?void 0:I.accessToken}`;default:return""}},credentials:"same-origin",get fetchApi(){return ee()==="p2p"&&te()?Ut():fetch},get basePath(){if(ee()==="http"){const e=Te();if(e)return ae(e.host,e.ssl)}return""}},$=new ge(gn),In=new mn($),Rn=new pn($);new fn($);const An=new wn($);function kn(n){I=n}export{fn as A,ge as C,ue as E,jt as R,Rn as a,qt as b,Tn as c,gn as d,Wt as e,An as f,ae as g,Ft as h,$ as i,_n as j,Sn as k,En as l,st as m,kn as s,In as t};
